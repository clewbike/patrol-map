<!doctype html>
<html lang="ja">
  
  <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>電池交換マップ</title>
  <meta name="robots" content="noindex,nofollow">

  <!-- PWA Manifest -->
  <link rel="manifest" href="./manifest.json">
  
  <!-- ファビコン（ブラウザ用） -->
  <link rel="icon" href="./icons/favicon.ico" type="image/x-icon">
  
  <!-- Android Chrome用テーマカラー -->
  <meta name="theme-color" content="#2c7be5">
  
  <!-- iPhone (Safari) ホーム追加アイコン -->
  <link rel="apple-touch-icon" href="./icons/apple-icon.png">
  
  <!-- Webアプリ名（iPhone用） -->
  <meta name="apple-mobile-web-app-title" content="電池交換マップ">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  
  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>
  
  <link rel="stylesheet" href="./src/css/app.css">
  </head>

  <body>
    <div id="map"></div>

  <!-- ── 左上：凡例 ── -->
  <div id="legend-top">
    <div class="legend-row">
      <div class="legend-left"><span class="legend-dot" style="color:#e60026;">●</span>交換必須</div>
      <div class="legend-count" id="cnt-urgent">0</div><div></div>
    </div>
    <div class="legend-row">
      <div class="legend-left"><span class="legend-dot" style="color:#ff8c00;">●</span>交換可能</div>
      <div class="legend-count" id="cnt-yellow">0</div>
      <div><input type="checkbox" id="chk-yellow" checked></div>
    </div>
    <div class="legend-row">
      <div class="legend-left"><span class="legend-dot" style="color:#6fa86f;">●</span>経過観測</div>
      <div class="legend-count" id="cnt-green">0</div>
      <div><input type="checkbox" id="chk-green"></div>
    </div>
    <div class="legend-note-wrap">
      <div class="legend-note">交換必須「10件以上」は<br>赤色ポートを優先巡回！</div>
      <button id="tipAll" class="tip-btn" title="定義を表示">i</button>
    </div>
  </div>

  <!-- ── 右上：ハンバーガー ── -->
  <button id="menuBtn" aria-label="一覧を開く">
    <svg viewBox="0 0 24 24"><path d="M4 6h16a1 1 0 1 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 1 1 0 2H4a1 1 0 0 1 0-2zm0 6h16a1 1 0 1 1 0 2H4a1 1 0 0 1 0-2z"/></svg>
  </button>

  <!-- ── 右スライド：電池交換ポート一覧 ── -->
  <div id="drawer" aria-hidden="true">
    <div class="drawer-head">
      <b>電池交換ポート一覧</b>
      <button class="drawer-close" id="drawerClose" aria-label="閉じる">×</button>
    </div>
    <div class="drawer-body">
      <!-- 固定①：フォーム行（2リンク） -->
      <div class="links-block">
        <div>🗒️ <a href="https://forms.gle/76DsMzvctM4ajJt86" target="_blank" rel="noopener">ポート巡回報告</a></div>
        <div>🔧 <a href="https://forms.gle/WTEwgx3QVEkprt176" target="_blank" rel="noopener">不具合/修理報告</a></div>
      </div>
      <!-- 固定②：検索バー -->
      <div class="tbl-tools">
        <input type="text" id="qGlobal" placeholder="🔎 キーワード検索（ポート名）" aria-label="キーワード検索">
      </div>
      <!-- 固定③：ヘッダー（thのstickyで固定）＋ 本文 -->
      <table class="tbl" id="portsTable">
        <thead>
          <tr>
            <th data-key="name"   class="col-name"  id="th-name">ポート名 <span class="sort" id="sort-name">⇅</span></th>
            <th data-key="weight" class="col-weight" id="th-weight">電池比重 <span class="sort" id="sort-weight">⇅</span></th>
            <th data-key="count"  class="col-count"  id="th-count">交換目安 <span class="sort" id="sort-count">⇅</span></th>
          </tr>
        </thead>
        <tbody id="portsTbody"></tbody>
      </table>
    </div>
  </div>

  <!-- ── 右下：未読更新ボタン & 現在地 & 更新時刻 ── -->
  <button id="refreshBtn">更新<span id="refreshBadge"></span></button>

  <div id="locateFab">
    <button id="locateBtn" class="fab-btn idle" title="現在地へ移動 / 追従ON（タップ直後のみ）">
      <svg viewBox="0 0 24 24"><path d="M12 2l6.5 18.5-6.5-3-6.5 3L12 2z"></path></svg>
    </button>
  </div>

  <div id="hud">
    <div id="legend"><strong>更新日時：</strong><span id="updateTime">読み込み中…</span></div>
    <div id="credit">
      © <a href="https://jawg.io" target="_blank" rel="noopener">Jawg Maps</a> /
      © <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap contributors</a>
    </div>
  </div>

  <!-- Tips -->
  <div id="tipBackdrop"></div>
  <div id="tipBox"></div>

  <script type="module" src="./src/js/main.js"></script>
</body>
</html>
